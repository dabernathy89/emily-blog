<nav class="bg-peach" x-data="{ openDropdown: null }">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        {{# Desktop nav #}}
        <div class="hidden lg:flex items-center justify-center gap-1 py-2">
            {{ nav:main max_depth="2" }}
                <div class="relative" @mouseenter="openDropdown = {{ count }}" @mouseleave="openDropdown = null">
                    <a href="{{ url }}"
                       class="font-display text-lg text-white hover:text-cream px-4 py-2 inline-block no-underline">
                        {{ title }}
                        {{ if children }}
                            <svg class="inline-block w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                        {{ /if }}
                    </a>
                    {{ if children }}
                        <div x-show="openDropdown === {{ count }}"
                             x-transition:enter="transition ease-out duration-150"
                             x-transition:enter-start="opacity-0 -translate-y-1"
                             x-transition:enter-end="opacity-100 translate-y-0"
                             x-transition:leave="transition ease-in duration-100"
                             x-transition:leave-start="opacity-100 translate-y-0"
                             x-transition:leave-end="opacity-0 -translate-y-1"
                             class="absolute left-0 top-full mt-0 bg-white rounded-b-lg shadow-lg min-w-48 z-50 py-2"
                             x-cloak>
                            {{ children }}
                                <a href="{{ url }}" class="block px-5 py-2 font-serif text-gray-700 hover:bg-cream hover:text-peach-dark no-underline">
                                    {{ title }}
                                </a>
                            {{ /children }}
                        </div>
                    {{ /if }}
                </div>
            {{ /nav:main }}
        </div>

        {{# Mobile hamburger #}}
        <div class="lg:hidden flex items-center justify-between py-3">
            <a href="/" class="font-display text-xl text-white no-underline">{{ settings:site_name ?? "Everyday Accounts" }}</a>
            <button @click="showMobileNav = !showMobileNav" class="text-white p-2" aria-label="Toggle navigation">
                <svg x-show="!showMobileNav" class="h-6 w-6 fill-current" viewBox="0 0 20 20"><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z" /></svg>
                <svg x-show="showMobileNav" class="h-6 w-6 fill-current" viewBox="0 0 20 20" x-cloak><path d="M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z" /></svg>
            </button>
        </div>
    </div>

    {{# Mobile menu panel #}}
    <div x-show="showMobileNav"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 -translate-y-2"
         x-transition:enter-end="opacity-100 translate-y-0"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100 translate-y-0"
         x-transition:leave-end="opacity-0 -translate-y-2"
         class="lg:hidden bg-white border-t border-peach-light shadow-lg"
         @click.outside="showMobileNav = false"
         x-cloak>
        <div class="max-w-6xl mx-auto px-4 py-4" x-data="{ openMobileSubmenu: null }">
            {{ nav:main max_depth="2" }}
                <div class="border-b border-gray-100 last:border-0">
                    {{ if children }}
                        <button @click="openMobileSubmenu = openMobileSubmenu === {{ count }} ? null : {{ count }}"
                                class="w-full flex items-center justify-between py-3 font-display text-lg text-peach-dark">
                            {{ title }}
                            <svg class="w-4 h-4 transition-transform" :class="openMobileSubmenu === {{ count }} ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                        </button>
                        <div x-show="openMobileSubmenu === {{ count }}" x-collapse class="pb-2 pl-4">
                            {{ children }}
                                <a href="{{ url }}" class="block py-2 font-serif text-gray-600 hover:text-peach-dark no-underline">{{ title }}</a>
                            {{ /children }}
                        </div>
                    {{ else }}
                        <a href="{{ url }}" class="block py-3 font-display text-lg text-peach-dark no-underline">{{ title }}</a>
                    {{ /if }}
                </div>
            {{ /nav:main }}
        </div>
    </div>
</nav>
